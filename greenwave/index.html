<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Greenwave | By Matt Jia</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="greenwave.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress" data-transition-duration="1500"><div class="step step-level-1" step="0" id="step1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="gating-on-automated-tests-in-fedora-greenwave">Gating on automated tests in Fedora - Greenwave</h1><p>Factory 2.0</p><p>Matt Jia &lt;<a href="mailto:mjia@redhat.com">mjia@redhat.com</a>&gt;</p></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="automated-test-results-in-bodhi">Automated test results in Bodhi</h1><img src="images/test-results.png" width="800px" height="600px"></img></div><div class="step step-level-1" step="2" id="greenwave" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="greenwave-is">Greenwave is:</h1><ul><li>a service for making decisions</li><li>about artifacts</li><li>at certain gating points</li><li>based on test results in ResultsDB</li><li>according to some policies</li></ul><img src="images/Greenwave.gif"></img></div><div class="step step-level-1" step="3" id="problem1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="problem-1">Problem #1</h1><p>No checks are required for all the distributions.</p><img src="images/quality-risk.jpg" width="800px" height="600px"></img></div><div class="step step-level-1" step="4" data-y="1000" id="checks" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-z="0"><h1 id="what-checks-do-we-want-to-enforce">What checks do we want to enforce?</h1><ul><li>dist.abicheck</li><li>dist.rpmdeplint</li><li>dist.upgradepath</li></ul></div><div class="step step-level-1" step="5" data-x="5600" data-scale="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-y="2000" data-z="0"><h1 id="problem-2">Problem #2</h1><p>Specifying required checks is a repetitive manual process</p><img src="images/repetitive-manual.jpg" width="800px" height="600px"></img></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="3000" data-z="0"><h1 id="why-a-new-service">Why a new service?</h1></div><div class="step step-level-1" step="7" id="badtest" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4000" data-y="4000" data-z="0"><h1 id="what-happens-when-a-test-goes-bad">What happens when a test goes bad?</h1><img src="images/broken-machine.jpg" width="600px" height="600px"></img></div><div class="step step-level-1" step="8" data-x="3500" data-scale="1" id="waiverdb" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-y="5000" data-z="0"><h1 id="waiverdb-is">WaiverDB is:</h1><ul><li>a microservice for storing waivers against test results in ResultsDB</li><li>generalizing the existing waiving functionalities</li></ul></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3000" data-y="6000" data-z="0"><img src="images/workflow.png" width="800px" height="600px"></img></div><div class="step step-level-1" step="10" id="freshmaker" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="2500" data-y="7000" data-z="0"><h1 id="help-freshmaker-enforce-quality">Help Freshmaker enforce quality</h1><p>Gating on the <em>rebuilds</em></p></div><div class="step step-level-1" step="11" id="underhood" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="2000" data-y="8000" data-z="0"><h1 id="how-greenwave-works-under-the-hood">How Greenwave works under the hood</h1><div class="notes"><p>So the next topic is I would like talk about how Greenwave works under the hood
and where are we at today with the current implementation. All of these three
services are implemented by using Flask which is a microframework for Python.
It is well documented and easy to code.</p></div></div><div class="step step-level-1" step="12" id="policyexample" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1500" data-y="9000" data-z="0"><h1 id="an-example-of-a-greenwave-policy">An example of a Greenwave policy</h1><pre class="highlight code YAML"><span class="nn">---</span> <span class="kt">!Policy</span>
<span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
<span class="l-Scalar-Plain">product_version</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">fedora-26</span>
<span class="l-Scalar-Plain">decision_context</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">bodhi_update_push_stable</span>
<span class="l-Scalar-Plain">rules</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="kt">!PassingTestCaseRule</span> <span class="p-Indicator">{</span><span class="nv">test_case_name</span><span class="p-Indicator">:</span> <span class="nv">dist.abicheck</span><span class="p-Indicator">}</span>
  <span class="p-Indicator">-</span> <span class="kt">!PassingTestCaseRule</span> <span class="p-Indicator">{</span><span class="nv">test_case_name</span><span class="p-Indicator">:</span> <span class="nv">dist.deplint</span><span class="p-Indicator">}</span>
  <span class="p-Indicator">-</span> <span class="kt">!PassingTestCaseRule</span> <span class="p-Indicator">{</span><span class="nv">test_case_name</span><span class="p-Indicator">:</span> <span class="nv">dist.upgradepath</span><span class="p-Indicator">}</span></pre></div><div class="step step-level-1" step="13" id="gapiexample" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1000" data-y="10000" data-z="0"><h1 id="an-example-of-calling-greenwave-api">An example of calling Greenwave API</h1><pre class="highlight code">$ http POST http://greenwave.stg.fedoraproject.org/api/v1.0/decision \
      decision_context=bodhi_update_push_stable \
      product_version=fedora-26 \
      subject:='[{"item":"glibc-1.0-1.f26", "type": "koji_build"}]'</pre><pre class="highlight code JSON"><span class="p">{</span>
    <span class="nt">"applicable_policies"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="nt">"policies_satisified"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">"summary"</span><span class="p">:</span> <span class="s2">"1 of 3 required tests failed"</span><span class="p">,</span>
    <span class="nt">"unsatisfied_requirements"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">"item"</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">"item"</span><span class="p">:</span> <span class="s2">"glibc-1.0-1.f26"</span><span class="p">,</span>
                <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"koji_build"</span>
            <span class="p">},</span>
            <span class="nt">"testcase"</span><span class="p">:</span> <span class="s2">"dist.abicheck"</span><span class="p">,</span>
            <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"test-result-failed"</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span></pre></div><div class="step step-level-1" step="14" id="wapiexample" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="500" data-y="11000" data-z="0"><h1 id="an-example-of-calling-waiverdb-api">An example of calling WaiverDB API</h1><pre class="highlight code">$ http --auth-type=negotiate --auth : POST \
     http://waiverdb.stg.fedoraproject.org/api/v1.0/waivers/ \
     result_id=1 \
     product_version=fedora-26 \
     waived=true \
     comment="Because I say it!"</pre><pre class="highlight code JSON"><span class="p">{</span>
    <span class="nt">"comment"</span><span class="p">:</span> <span class="s2">"Because I say it!"</span><span class="p">,</span>
    <span class="nt">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">"product_version"</span><span class="p">:</span> <span class="s2">"fedora-26"</span><span class="p">,</span>
    <span class="nt">"result_id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">"timestamp"</span><span class="p">:</span> <span class="s2">"2017-08-16T22:21:29.926900"</span><span class="p">,</span>
    <span class="nt">"username"</span><span class="p">:</span> <span class="s2">"mjia"</span><span class="p">,</span>
    <span class="nt">"waived"</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span></pre></div><div class="step step-level-1" step="15" id="nextsteps" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="12000" data-z="0"><h1 id="next-steps">Next steps</h1><ul><li>Bodhi integration</li><li>Message bus driven</li><li>Per package policy</li></ul></div><div class="step step-level-1" step="16" id="examples" data-rotate-x="0" data-rotate-y="0" data-rotate-z="120" data-scale="1" data-x="-500" data-y="13000" data-z="0"><h1 id="questions"><em>Questions?</em></h1><ul><li><a href="https://pagure.io/greenwave">https://pagure.io/greenwave</a></li><li><a href="https://pagure.io/waiverdb">https://pagure.io/waiverdb</a></li></ul></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>